<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Uproot Clean & Catch</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top, #fdfbff 0%, #d9f3ff 40%, #b8e0ff 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #0f172a;
    }

    .app-shell {
      width: 100%;
      max-width: 480px;
      background: rgba(255, 255, 255, 0.96);
      border-radius: 24px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.2);
      padding: 20px 20px 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .logo-row {
      display: flex;
      justify-content: center;
      align-items: center;
      padding-bottom: 4px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
    }

    .logo-row img {
      max-width: 170px;
      height: auto;
      object-fit: contain;
    }

    .screen {
      display: none;
      animation: fadeIn 220ms ease-out;
    }

    .screen.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .intro-card {
      text-align: center;
      padding: 12px 4px 4px;
    }

    .eyebrow {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #38bdf8;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .title {
      font-size: 1.45rem;
      font-weight: 700;
      color: #0f172a;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 0.95rem;
      color: #64748b;
      margin-bottom: 16px;
    }

    .reward-pills {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-bottom: 18px;
    }

    .reward-pill {
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.78rem;
      background: rgba(56, 189, 248, 0.08);
      color: #0369a1;
      border: 1px solid rgba(56, 189, 248, 0.35);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .reward-pill span.icon {
      font-size: 0.92rem;
    }

    .primary-btn,
    .secondary-btn,
    .ghost-btn {
      width: 100%;
      padding: 11px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.96rem;
      font-weight: 600;
      transition: transform 80ms ease, box-shadow 80ms ease, background 120ms ease, color 120ms ease;
    }

    .primary-btn {
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      color: #f8fafc;
      box-shadow: 0 12px 25px rgba(34, 197, 94, 0.35);
    }

    .primary-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 30px rgba(34, 197, 94, 0.45);
    }

    .secondary-btn {
      background: rgba(15, 23, 42, 0.03);
      color: #0f172a;
      border: 1px solid rgba(148, 163, 184, 0.5);
      box-shadow: 0 6px 12px rgba(15, 23, 42, 0.08);
    }

    .secondary-btn:hover {
      background: rgba(15, 23, 42, 0.06);
      transform: translateY(-1px);
    }

    .ghost-btn {
      background: transparent;
      color: #0369a1;
      border: none;
      text-decoration: underline;
      text-underline-offset: 3px;
      font-weight: 500;
      box-shadow: none;
      padding-top: 6px;
      padding-bottom: 6px;
    }

    .ghost-btn:hover {
      color: #0ea5e9;
    }

    .btn-stack {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 4px;
    }

    /* GAME SCREEN */

    .game-shell {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.86rem;
      color: #64748b;
    }

    .badge {
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.1);
      color: #0369a1;
      font-weight: 600;
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .game-stats {
      display: flex;
      gap: 10px;
    }

    .stat-chip {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.03);
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    canvas {
      width: 100%;
      max-width: 440px;
      aspect-ratio: 3 / 4;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: linear-gradient(to bottom, #f0f9ff 0%, #e0f2fe 30%, #dcfce7 100%);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.6);
      display: block;
      margin-inline: auto;
      touch-action: none;
    }

    .game-help {
      font-size: 0.8rem;
      color: #94a3b8;
      text-align: center;
      margin-top: 4px;
    }

    /* QUESTIONS */

    .questions-card {
      display: flex;
      flex-direction: column;
      gap: 12px;
      font-size: 0.9rem;
    }

    .questions-card h2 {
      font-size: 1.2rem;
      margin-bottom: 4px;
    }

    .question-block {
      padding: 10px 10px 8px;
      border-radius: 14px;
      background: rgba(248, 250, 252, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .question-label {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 6px;
      color: #0f172a;
    }

    .option-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .option-pill {
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: white;
      font-size: 0.78rem;
      cursor: pointer;
      color: #475569;
    }

    .option-pill.selected {
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      border-color: transparent;
      color: #f9fafb;
      box-shadow: 0 6px 14px rgba(34, 197, 94, 0.45);
    }

    .scale-row {
      display: flex;
      gap: 6px;
    }

    .scale-pill {
      width: 32px;
      padding: 6px 0;
      text-align: center;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: white;
      font-size: 0.8rem;
      cursor: pointer;
      color: #475569;
    }

    .scale-pill.selected {
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      border-color: transparent;
      color: #f9fafb;
      box-shadow: 0 6px 14px rgba(34, 197, 94, 0.45);
    }

    /* RESULT */

    .result-card {
      text-align: center;
      padding: 8px 4px 0;
    }

    .reward-highlight {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 4px;
      color: #0f172a;
    }

    .reward-sub {
      font-size: 0.9rem;
      color: #64748b;
      margin-bottom: 10px;
    }

    .result-tagline {
      font-size: 0.78rem;
      color: #94a3b8;
      margin-bottom: 12px;
    }

    /* SHARE CARD */

    .share-card-wrapper {
      margin-top: 8px;
      margin-bottom: 10px;
    }

    .share-card {
      display: inline-block;
      text-align: left;
      padding: 12px 14px;
      border-radius: 18px;
      background: radial-gradient(circle at top left, #e0f2fe 0%, #f9fafb 45%, #e5f9f0 100%);
      border: 1px solid rgba(148, 163, 184, 0.5);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.18);
      min-width: 260px;
    }

    .share-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .share-card-logo {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .share-card-logo img {
      height: 26px;
      width: auto;
    }

    .share-card-brand {
      font-size: 0.78rem;
      font-weight: 600;
      color: #0f172a;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .share-card-tag {
      font-size: 0.72rem;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.08);
      color: #047857;
      border: 1px solid rgba(34, 197, 94, 0.4);
    }

    .share-card-main {
      font-size: 0.86rem;
      color: #0f172a;
      margin-bottom: 4px;
    }

    .share-card-sub {
      font-size: 0.8rem;
      color: #475569;
    }

    @media (max-width: 520px) {
      .app-shell {
        margin: 10px;
        border-radius: 18px;
        padding: 16px 14px 18px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="logo-row">
      <img src="uproot-clean-logo.png" alt="Uproot Clean Logo" />
    </div>

    <!-- INTRO SCREEN -->
    <div id="screen-intro" class="screen active">
      <div class="intro-card">
        <div class="eyebrow">Uproot Clean & Catch</div>
        <div class="title">Catch & win your clean-laundry upgrade</div>
        <div class="subtitle">
          Play a quick 5-ball drop game to unlock
          <span style="white-space:nowrap;">free shipping</span> and extra savings on your next clean-home routine.
        </div>

        <div class="reward-pills">
          <div class="reward-pill">
            <span class="icon">üí∏</span> 5‚Äì10% off
          </div>
          <div class="reward-pill">
            <span class="icon">üöö</span> Free shipping top tier
          </div>
          <div class="reward-pill">
            <span class="icon">‚è±Ô∏è</span> 30 seconds, 5 drops
          </div>
        </div>

        <div class="btn-stack">
          <button class="primary-btn" id="startGameBtn">
            Play now & unlock your reward
          </button>
        </div>
      </div>
    </div>

    <!-- GAME SCREEN -->
    <div id="screen-game" class="screen">
      <div class="game-shell">
        <div class="game-header">
          <span class="badge">Skill game</span>
          <div class="game-stats">
            <div class="stat-chip" id="caughtStat">Caught: 0</div>
            <div class="stat-chip" id="leftStat">Drops left: 5</div>
          </div>
        </div>

        <canvas id="gameCanvas" width="360" height="480"></canvas>
        <div class="game-help">
          Move the basket with your mouse, touch, or arrow keys. Catch as many drops as you can!
        </div>
      </div>
    </div>

    <!-- QUESTIONS SCREEN -->
    <div id="screen-questions" class="screen">
      <div class="questions-card">
        <div>
          <div class="eyebrow">Just a few quick taps</div>
          <h2>Tell us about your laundry life</h2>
          <p class="subtitle" style="margin-bottom: 10px;">
            We will use this to recommend better routines and future rewards that actually fit your home.
          </p>
        </div>

        <!-- Q1 -->
        <div class="question-block">
          <div class="question-label">Do you have pets?</div>
          <div class="option-row" data-question="pets">
            <button class="option-pill" data-value="yes">Yes</button>
            <button class="option-pill" data-value="no">No</button>
          </div>
        </div>

        <!-- Q2 -->
        <div class="question-block">
          <div class="question-label">What type of washing machine do you use?</div>
          <div class="option-row" data-question="machine">
            <button class="option-pill" data-value="top">Top loader</button>
            <button class="option-pill" data-value="front">Front loader</button>
          </div>
        </div>

        <!-- Q3 -->
        <div class="question-block">
          <div class="question-label">What is your biggest laundry frustration?</div>
          <div class="option-row" data-question="frustration">
            <button class="option-pill" data-value="smell">Smell</button>
            <button class="option-pill" data-value="stains">Stains</button>
            <button class="option-pill" data-value="time">Time</button>
            <button class="option-pill" data-value="petHair">Pet hair</button>
          </div>
        </div>

        <!-- Q4 -->
        <div class="question-block">
          <div class="question-label">Do you have a dog or cat?</div>
          <div class="option-row" data-question="petType">
            <button class="option-pill" data-value="dog">Dog</button>
            <button class="option-pill" data-value="cat">Cat</button>
            <button class="option-pill" data-value="both">Both</button>
            <button class="option-pill" data-value="neither">Neither</button>
          </div>
        </div>

        <!-- Q5 -->
        <div class="question-block">
          <div class="question-label">How important is a clean / fresh home?</div>
          <div class="scale-row" data-question="cleanScore">
            <button class="scale-pill" data-value="1">1</button>
            <button class="scale-pill" data-value="2">2</button>
            <button class="scale-pill" data-value="3">3</button>
            <button class="scale-pill" data-value="4">4</button>
            <button class="scale-pill" data-value="5">5</button>
          </div>
          <div style="font-size:0.75rem;color:#9ca3af;margin-top:4px;">
            1 = ‚ÄúNice to have‚Äù ¬∑ 5 = ‚ÄúNon-negotiable‚Äù
          </div>
        </div>

        <div class="btn-stack" style="margin-top: 6px;">
          <button class="primary-btn" id="submitAnswersBtn">
            Lock in my reward
          </button>
        </div>
      </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="screen-result" class="screen">
      <div class="result-card">
        <div class="eyebrow">Nice catch</div>
        <div id="rewardHeadline" class="reward-highlight">
          Reward headline here
        </div>
        <div id="rewardSub" class="reward-sub">
          Reward description here
        </div>
        <div class="result-tagline">
          Share your result with your agent so they can apply the reward to your order.
        </div>

        <!-- Share-ready card (this is what becomes the image) -->
        <div class="share-card-wrapper">
          <div id="shareCard" class="share-card">
            <div class="share-card-header">
              <div class="share-card-logo">
                <img src="uproot-clean-logo.png" alt="Uproot Clean" />
                <span class="share-card-brand">Uproot Catch &amp; Clean</span>
              </div>
              <span class="share-card-tag">Reward unlocked</span>
            </div>
            <div id="shareSummary" class="share-card-main">
              Uproot Clean & Catch result: I caught 0 of 5 drops and unlocked: 5% Off.
            </div>
            <div id="shareSubline" class="share-card-sub">
              Share this with your agent so they can apply the reward to my order.
            </div>
          </div>
        </div>

        <div class="btn-stack">
          <button class="secondary-btn" id="playDemoBtn">
            Play again (demo)
          </button>
          <button class="primary-btn" id="saveCardBtn">
            Save result card image
          </button>
          <button class="ghost-btn" id="copyShareTextBtn">
            Copy result text for my agent
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- html2canvas for turning the card into an image -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    // --------- SCREEN HANDLING ----------
    const screens = {
      intro: document.getElementById("screen-intro"),
      game: document.getElementById("screen-game"),
      questions: document.getElementById("screen-questions"),
      result: document.getElementById("screen-result"),
    };

    function showScreen(name) {
      Object.values(screens).forEach((el) => el.classList.remove("active"));
      screens[name].classList.add("active");
    }

    // --------- GAME LOGIC ----------
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const caughtStat = document.getElementById("caughtStat");
    const leftStat = document.getElementById("leftStat");

    const TOTAL_BALLS = 5;
    let ballsCaught = 0;
    let ballsUsed = 0;

    let ball = null;
    let basket = null;
    let pegs = [];
    let topRowPegXs = [];

    let gameRunning = false;
    let lastTimestamp = 0;

    const BASKET_BASE_WIDTH = 70; // already reduced width

    function initPegs() {
      pegs = [];
      topRowPegXs = [];

      const rows = 6;
      const cols = 7;
      const pegRadius = 6;
      const verticalSpacing = 52;
      const horizontalSpacing = 46;
      const topOffset = 60;
      const sideMargin = 40;

      for (let r = 0; r < rows; r++) {
        const y = topOffset + r * verticalSpacing;
        const staggerOffset = (r % 2 === 0) ? 0 : horizontalSpacing / 2;

        for (let c = 0; c < cols; c++) {
          let x = sideMargin + c * horizontalSpacing + staggerOffset;
          if (x < pegRadius + 8 || x > canvas.width - pegRadius - 8) continue;

          pegs.push({ x, y, radius: pegRadius });
          if (r === 0) {
            topRowPegXs.push(x);
          }
        }
      }
    }

    function resetGameState() {
      ballsCaught = 0;
      ballsUsed = 0;
      caughtStat.textContent = "Caught: 0";
      leftStat.textContent = "Drops left: " + TOTAL_BALLS;

      const basketWidth = BASKET_BASE_WIDTH;
      basket = {
        width: basketWidth,
        height: 14,
        x: (canvas.width - basketWidth) / 2,
        y: canvas.height - 40,
        speed: 6,
      };

      initPegs();
      ball = null;
      gameRunning = true;
    }

    function createNewBall() {
      if (ballsUsed >= TOTAL_BALLS) {
        endGame();
        return;
      }

      ballsUsed++;
      leftStat.textContent = "Drops left: " + (TOTAL_BALLS - ballsUsed);

      const ballRadius = 8;

      const startX =
        topRowPegXs.length > 0
          ? topRowPegXs[Math.floor(Math.random() * topRowPegXs.length)]
          : canvas.width / 2;

      ball = {
        x: startX,
        y: 20,
        vx: 0,
        vy: 0.5,
        radius: ballRadius,
      };
    }

    function endGame() {
      gameRunning = false;
      setTimeout(() => {
        showScreen("questions");
      }, 550);
    }

    function updateBallPhysics(delta) {
      if (!ball) return;

      const gravity = 0.26;
      const damping = 0.82;

      ball.vy += gravity;
      ball.x += ball.vx;
      ball.y += ball.vy;

      // walls
      if (ball.x - ball.radius < 0) {
        ball.x = ball.radius;
        ball.vx = -ball.vx * damping;
      } else if (ball.x + ball.radius > canvas.width) {
        ball.x = canvas.width - ball.radius;
        ball.vx = -ball.vx * damping;
      }

      // pegs
      for (const peg of pegs) {
        const dx = ball.x - peg.x;
        const dy = ball.y - peg.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        const minDist = ball.radius + peg.radius;

        if (dist < minDist && dist > 0) {
          const overlap = minDist - dist;
          const nx = dx / dist;
          const ny = dy / dist;

          ball.x += nx * (overlap + 0.2);
          ball.y += ny * (overlap + 0.2);

          const dot = ball.vx * nx + ball.vy * ny;
          ball.vx = ball.vx - 2 * dot * nx;
          ball.vy = ball.vy - 2 * dot * ny;

          ball.vx *= damping;
          ball.vy *= damping;

          ball.vx += (Math.random() - 0.5) * 0.4;
        }
      }

      // basket catch
      if (
        ball.y + ball.radius >= basket.y &&
        ball.y + ball.radius <= basket.y + basket.height + 2 &&
        ball.x >= basket.x &&
        ball.x <= basket.x + basket.width &&
        ball.vy > 0
      ) {
        ballsCaught++;
        caughtStat.textContent = "Caught: " + ballsCaught;
        ball = null;

        setTimeout(() => {
          createNewBall();
        }, 400);
        return;
      }

      // below screen
      if (ball.y - ball.radius > canvas.height + 10) {
        ball = null;
        setTimeout(() => {
          createNewBall();
        }, 400);
      }
    }

    function drawGame() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
      grad.addColorStop(0, "rgba(255,255,255,0.4)");
      grad.addColorStop(1, "rgba(255,255,255,0)");
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // pegs
      for (const peg of pegs) {
        ctx.beginPath();
        const outerGrad = ctx.createRadialGradient(
          peg.x - 1,
          peg.y - 1,
          1,
          peg.x,
          peg.y,
          peg.radius + 1
        );
        outerGrad.addColorStop(0, "#e0f2fe");
        outerGrad.addColorStop(1, "#0ea5e9");
        ctx.fillStyle = outerGrad;
        ctx.arc(peg.x, peg.y, peg.radius, 0, Math.PI * 2);
        ctx.fill();
      }

      // basket
      ctx.save();
      ctx.fillStyle = "#0f172a";
      ctx.beginPath();
      const r = 8;
      const bx = basket.x;
      const by = basket.y;
      const bw = basket.width;
      const bh = basket.height;
      ctx.moveTo(bx + r, by);
      ctx.lineTo(bx + bw - r, by);
      ctx.quadraticCurveTo(bx + bw, by, bx + bw, by + r);
      ctx.lineTo(bx + bw, by + bh);
      ctx.lineTo(bx, by + bh);
      ctx.lineTo(bx, by + r);
      ctx.quadraticCurveTo(bx, by, bx + r, by);
      ctx.closePath();
      ctx.fill();

      ctx.strokeStyle = "rgba(248,250,252,0.8)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(bx + 6, by + 2);
      ctx.lineTo(bx + bw - 6, by + 2);
      ctx.stroke();
      ctx.restore();

      // ball
      if (ball) {
        ctx.save();
        const bGrad = ctx.createRadialGradient(
          ball.x - 3,
          ball.y - 3,
          2,
          ball.x,
          ball.y,
          ball.radius + 2
        );
        bGrad.addColorStop(0, "#fefce8");
        bGrad.addColorStop(1, "#facc15");
        ctx.fillStyle = bGrad;
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }
    }

    function gameLoop(timestamp) {
      const delta = timestamp - lastTimestamp;
      lastTimestamp = timestamp;

      if (screens.game.classList.contains("active") && gameRunning) {
        updateBallPhysics(delta);
        drawGame();
      } else if (screens.game.classList.contains("active")) {
        drawGame();
      }

      requestAnimationFrame(gameLoop);
    }

    function moveBasket(dx) {
      if (!basket) return;
      basket.x += dx;
      if (basket.x < 0) basket.x = 0;
      if (basket.x + basket.width > canvas.width) {
        basket.x = canvas.width - basket.width;
      }
    }

    document.addEventListener("keydown", (e) => {
      if (!screens.game.classList.contains("active")) return;
      if (!basket) return;
      if (e.key === "ArrowLeft") {
        moveBasket(-basket.speed);
      } else if (e.key === "ArrowRight") {
        moveBasket(basket.speed);
      }
    });

    // Desktop mouse move
    canvas.addEventListener("mousemove", (e) => {
      if (!screens.game.classList.contains("active")) return;
      if (!basket) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      basket.x = x - basket.width / 2;
      if (basket.x < 0) basket.x = 0;
      if (basket.x + basket.width > canvas.width) {
        basket.x = canvas.width - basket.width;
      }
    });

    // Mobile touch move
    function handleTouchMove(e) {
      if (!screens.game.classList.contains("active")) return;
      if (!basket) return;
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      const scaleX = canvas.width / rect.width;
      const canvasX = (touch.clientX - rect.left) * scaleX;

      basket.x = Math.max(
        0,
        Math.min(canvas.width - basket.width, canvasX - basket.width / 2)
      );
    }

    canvas.addEventListener("touchstart", handleTouchMove, { passive: false });
    canvas.addEventListener("touchmove", handleTouchMove, { passive: false });

    // --------- QUESTIONS / ANSWERS ----------
    const answerState = {
      pets: null,
      machine: null,
      frustration: null,
      petType: null,
      cleanScore: null,
    };

    function wireOptionGroup(questionName, selector, pillClass) {
      const group = document.querySelector(selector + "[data-question='" + questionName + "']");
      if (!group) return;
      group.addEventListener("click", (e) => {
        const btn = e.target.closest("." + pillClass);
        if (!btn) return;
        const value = btn.getAttribute("data-value");
        answerState[questionName] = value;

        Array.from(group.children).forEach((child) =>
          child.classList.remove("selected")
        );
        btn.classList.add("selected");
      });
    }

    wireOptionGroup("pets", ".option-row", "option-pill");
    wireOptionGroup("machine", ".option-row", "option-pill");
    wireOptionGroup("frustration", ".option-row", "option-pill");
    wireOptionGroup("petType", ".option-row", "option-pill");
    wireOptionGroup("cleanScore", ".scale-row", "scale-pill");

    function computeRewardText() {
      let headline = "";
      let sub = "";

      // New reward mapping:
      // 0‚Äì1 = 5% off
      // 2‚Äì3 = 10% off
      // 4‚Äì5 = 10% off + Free Shipping
      if (ballsCaught <= 1) {
        headline = "You unlocked 5% Off üí∏";
        sub =
          "Thanks for playing! You earned 5% off your next clean-home order. Your unique reward will be wired into this flow.";
      } else if (ballsCaught <= 3) {
        headline = "You unlocked 10% Off ‚ú®";
        sub =
          "Nice catching. You earned 10% off your next order. Your code or link will be connected here by your agent.";
      } else {
        headline = "10% Off + Free Shipping üèÜ";
        sub =
          "You crushed it. You unlocked 10% off plus free shipping on your next order. Your high score just upgraded laundry day.";
      }

      return { headline, sub };
    }

    let shareMessage = "";

    function updateShareCard(headline) {
      const summaryEl = document.getElementById("shareSummary");
      const sublineEl = document.getElementById("shareSubline");

      const cleanHeadline = headline.replace(/ [üéÅ‚ú®üèÜ]/g, "");
      const summary =
        `üèÜ I caught ${ballsCaught} of 5 drops and unlocked: ${cleanHeadline} üéâ`;
      const subline =
        "Share this with your agent so they can apply the reward to your order.";

      summaryEl.textContent = summary;
      sublineEl.textContent = subline;

      shareMessage = `${summary}\n\n${subline}`;
      shareMessage = 
        `üèÜ Uproot Clean & Catch Result!\n` +
        `I caught ${ballsCaught} of 5 drops and unlocked: ${cleanHeadline} üéâ\n\n` +
        `Share this with your agent so they can apply the reward to your order.`;

    }

    // --------- EVENT WIRING ----------
    document.getElementById("startGameBtn").addEventListener("click", () => {
      showScreen("game");
      resetGameState();
      createNewBall();
    });

    document.getElementById("submitAnswersBtn").addEventListener("click", () => {
      const { headline, sub } = computeRewardText();
      document.getElementById("rewardHeadline").textContent = headline;
      document.getElementById("rewardSub").textContent = sub;

      // Update share card + text
      updateShareCard(headline);

      // Here is where you'd send `answerState` and `ballsCaught` to your backend.

      showScreen("result");
    });

    document.getElementById("playDemoBtn").addEventListener("click", () => {
      showScreen("game");
      resetGameState();
      createNewBall();
    });

    // Copy result text
    document.getElementById("copyShareTextBtn").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(shareMessage || "");
        alert("Result text copied. Paste this into your message to your agent.");
      } catch (err) {
        alert("Could not copy automatically. You may need to copy manually.");
      }
    });

    // Save result card as image (PNG)
    document.getElementById("saveCardBtn").addEventListener("click", () => {
      const card = document.getElementById("shareCard");
      html2canvas(card, { backgroundColor: null, scale: 2 }).then((canvas) => {
        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "uproot-clean-catch-result.png";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        });
      });
    });

    // Start loop
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>
